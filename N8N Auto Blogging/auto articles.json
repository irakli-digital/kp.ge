{
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -2624,
        3240
      ],
      "id": "fd91bf13-0b4c-4466-8c9b-45b2ff3f8d77",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "jsCode": "// Pass through article data - webhook will automatically upload and host images\n// The webhook endpoint handles image uploads server-side when it receives the content\nconst input = $input.first().json;\nconst article = input.output || input;\n\n// Return article data as-is - webhook will:\n// 1. Extract image URLs from HTML content\n// 2. Download images from external URLs\n// 3. Upload them to our server\n// 4. Replace URLs in HTML with hosted URLs\nreturn [{\n  json: {\n    output: article\n  }\n}];"
      },
      "id": "730d2737-2782-45ae-84db-56de5e4fd6e5",
      "name": "Prepare for Webhook",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -128,
        3240
      ]
    },
    {
      "parameters": {
        "jsCode": "// Extract and format images from the article\nconst input = $input.first().json;\nconst htmlData = input.data || '';\nlet imageSrcs = input.images || [];\n\n// Handle case where images might be a single value or array\nif (!Array.isArray(imageSrcs)) {\n  imageSrcs = imageSrcs ? [imageSrcs] : [];\n}\n\n// Convert relative URLs to absolute URLs if needed\nconst articleUrl = $('Get Article3').first().json.url || '';\nconst baseUrl = articleUrl ? new URL(articleUrl).origin : '';\n\nconst processedImages = imageSrcs.map(src => {\n  if (!src || typeof src !== 'string') return null;\n  // If relative URL, make it absolute\n  if (src.startsWith('//')) {\n    return 'https:' + src;\n  }\n  if (src.startsWith('/')) {\n    return baseUrl + src;\n  }\n  if (src.startsWith('http')) {\n    return src;\n  }\n  return baseUrl + '/' + src;\n}).filter(Boolean);\n\n// Format images as a list for the LLM\nconst imagesList = processedImages.length > 0 \n  ? processedImages.map((url, idx) => `Image ${idx + 1}: ${url}`).join('\\n')\n  : 'No images found in article';\n\nreturn [{\n  json: {\n    data: htmlData,\n    images: imagesList,\n    imageUrls: processedImages\n  }\n}];"
      },
      "id": "fd1aa36e-d9e4-41d8-8f5e-58285e29e39d",
      "name": "Process Images3",
      "type": "n8n-nodes-base.code",
      "position": [
        -704,
        3240
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// Prepare webhook payload with proper data mapping\nconst input = $input.first().json;\n\n// Information Extractor outputs data nested under 'output' object\n// Structure: { output: { title: '...', summary: '...', body: '...', featured_image: '...' } }\nconst article = input.output || input;\n\n// Extract fields from nested output structure\nconst title = article.title || '';\nconst summary = article.summary || '';\nconst body = article.body || '';\nconst featured_image = article.featured_image || null;\n\n// Validate required fields\nif (!title || typeof title !== 'string' || title.trim() === '') {\n  throw new Error('Title is required but was empty or missing');\n}\n\nif (!body || typeof body !== 'string' || body.trim() === '') {\n  throw new Error('Body/content is required but was empty or missing');\n}\n\n// Get first image from processed images as fallback\nconst processedImages = $('Process Images3').first().json.imageUrls || [];\nconst firstImage = processedImages.length > 0 ? processedImages[0] : null;\n\n// Use LLM-provided featured_image or fallback to first image\n// Handle case where LLM might return 'null' as string\nlet finalFeaturedImage = featured_image;\nif (!finalFeaturedImage || finalFeaturedImage === 'null' || finalFeaturedImage === 'None' || finalFeaturedImage === '') {\n  finalFeaturedImage = firstImage;\n}\n\n// Validate featured_image URL format if provided\n// Note: Webhook will handle uploading external images\nif (finalFeaturedImage && typeof finalFeaturedImage === 'string') {\n  try {\n    new URL(finalFeaturedImage);\n  } catch (e) {\n    // Invalid URL, set to null\n    finalFeaturedImage = null;\n  }\n}\n\n// Prepare payload matching webhook schema\nconst payload = {\n  title: title.trim(),\n  title_ka: title.trim(),\n  content: body.trim(),\n  content_ka: body.trim(),\n  excerpt: (summary || '').trim(),\n  excerpt_ka: (summary || '').trim(),\n  featured_image: finalFeaturedImage || null,\n  author: 'Mypen Team',\n  published: true\n};\n\n// Final validation\nif (payload.title.length === 0) {\n  throw new Error('Title cannot be empty after trimming');\n}\n\nif (payload.content.length === 0) {\n  throw new Error('Content cannot be empty after trimming');\n}\n\nreturn [{ json: payload }];"
      },
      "id": "36c55f68-f7ef-4119-ad05-ca6dec757ad6",
      "name": "Prepare Webhook Payload3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        96,
        3240
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Edit Fields3').item.json.Webhook }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "id": "607cfbbc-9eec-451c-be77-cebaa049ddca",
      "name": "Send to Webhook3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        320,
        3240
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "e4xkr4s6jVKWYVY0",
          "name": "MPEN - IC"
        }
      }
    },
    {
      "parameters": {
        "text": "={{ $json.data }}\n\n## Images from Original Article:\n{{ $json.images }}",
        "attributes": {
          "attributes": [
            {
              "name": "title",
              "description": "title of article in Georgian",
              "required": true
            },
            {
              "name": "summary",
              "description": "summary of article in Georgian (150-160 characters for SEO)",
              "required": true
            },
            {
              "name": "body",
              "description": "body of article in Georgian as clean, semantic HTML",
              "required": true
            },
            {
              "name": "featured_image",
              "description": "URL of the best image from the article to use as featured image (first relevant image, or null if none)"
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "=You are a professional blog content writer specializing in rewriting and translating articles to Georgian. You follow strict brand voice guidelines and SEO best practices.\n\n## PRIMARY TASK\nRewrite the provided article in Georgian, creating original content that preserves the core message, information, and approximate length of the source material.\n\n## CRITICAL RULES\n\n### Content Rules\n1. **TRANSLATE TO GEORGIAN** - The entire output (title, summary, body) must be in Georgian\n2. **REWRITE COMPLETELY** - Create original Georgian content; do not translate word-for-word or copy phrases\n3. **MAINTAIN LENGTH** - Keep the rewritten article roughly the same length as the original\n4. **PRESERVE KEY INFORMATION** - All important facts, insights, and takeaways must be retained\n\n### Removal Rules (STRICT)\n5. **NO DATES** - Remove all publication dates; the publishing date is not yet determined\n6. **NO SOURCE ATTRIBUTION** - Do not mention the original website name, company name, or source\n7. **NO AUTHOR CREDIT** - Do not include author names or bylines\n8. **NO EXTERNAL HYPERLINKS** - Remove all URLs and hyperlinks from the original article; do not link to external websites\n\n### Image Rules\n9. **PRESERVE IMAGE URLs** - Use the exact original image URLs provided; do not modify them\n10. **TRANSLATE ALT TEXT** - Write descriptive alt text in Georgian for each image\n11. **EMBED NATURALLY** - Place images contextually within the content where they make sense\n\n### Format Rules\n12. **OUTPUT HTML ONLY** - Body must be clean, semantic HTML (NOT Markdown)\n13. **FOLLOW BRAND VOICE** - Strictly adhere to the brand voice guide provided below\n\n## SEO & HTML REQUIREMENTS\n{{ $('Edit Fields3').item.json['SEO Writing rules'] }}\n## HTML STRUCTURE EXAMPLE\n<h2>სათაური</h2>\n<p>პარაგრაფი ტექსტით...</p>\n<img src=\"original-image-url.jpg\" alt=\"აღწერა ქართულად\" />\n<h3>ქვესათაური</h3>\n<p>მეტი ტექსტი...</p>\n<ul>\n  <li>სიის ელემენტი 1</li>\n  <li>სიის ელემენტი 2</li>\n</ul>\n\n## BRAND VOICE GUIDE\n{{ $('Edit Fields3').item.json['Brand Voice'] }}\n## SELF-CHECK BEFORE OUTPUT\nBefore finalizing, verify:\n- [ ] All text is in Georgian (no English words except proper nouns if necessary)\n- [ ] All HTML tags are properly opened and closed\n- [ ] No hyperlinks or URLs appear in the text content\n- [ ] No mention of original source, website, or author\n- [ ] No publication dates included\n- [ ] All images use original URLs with Georgian alt text\n- [ ] Content length is approximately equal to the original\n\n\nNow rewrite this article in Georgian following all rules above. Output only the final HTML content with no additional commentary."
        }
      },
      "id": "db3710ca-3cfc-4f13-a349-74192f4047f9",
      "name": "Rewrite and Translate Article3",
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "position": [
        -480,
        3240
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "url": "={{ $json.link }}",
        "options": {}
      },
      "id": "b38dc0de-1181-4be4-a278-3d56935db0d7",
      "name": "Get Article3",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1152,
        3240
      ],
      "typeVersion": 4.2
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "data",
              "cssSelector": "article",
              "returnValue": "html"
            },
            {
              "key": "images",
              "cssSelector": "img",
              "returnValue": "attribute",
              "attribute": "src"
            }
          ]
        },
        "options": {}
      },
      "id": "2fabe33f-c38e-47be-9519-17d13302517d",
      "name": "Extract Article Content3",
      "type": "n8n-nodes-base.html",
      "position": [
        -928,
        3240
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8739c4a4-a9ed-47b0-b9a7-192baac7fd28",
              "name": "Brand Voice",
              "value": "# **Brand Voice Guide – AI Tools & AI News Blog (Georgian)**\n\n## **1. Core Identity**\n\n**Friendly expert.**\nExplains complex AI topics simply, never oversimplifies.\nTone stays conversational, practical, and reader-focused.\n\n---\n\n## **2. Tone**\n\n* **Warm, direct, human.**\n* **Authoritative without being rigid.**\n* **Energetic but not hype-driven.**\n* **Curious, excited about new tools.**\n\nExamples (in Georgian style):\n\n* “მოკლედ, რა უნდა იცოდე…”\n* “ერთი სიტყვით, ეს ფუნქცია ნამდვილ მოწყობილ ‘shortcut’-ად იქცევა.”\n* “მოდი პრაქტიკულად გავიგოთ, რას ნიშნავს ეს შენთვის.”\n\n---\n\n## **3. Style**\n\n* Short paragraphs.\n* Clear structure: **what it is → why it matters → how to use → quick verdict**.\n* Avoid long academic sentences.\n* Use everyday examples, not theory.\n\n---\n\n## **4. Language (Georgian-Specific Rules)**\n\nTo ensure correctness and natural flow:\n\n**Grammar & Syntax**\n\n* Prefer **active voice**:\n  “AI გეტყვის…” instead of “AI-ის მიერ ითქმება…”\n* Keep verb endings consistent with modern spoken Georgian:\n  use “გაიგებ”, not “გაიგებთ”, unless speaking formally.\n* Avoid literal English calques. Use native constructions:\n\n  * “შესაძლებლობა”, not “ოპშენი”.\n  * “პარამეტრი”, not “სეტინგი” (unless tool-specific).\n  * “შენახვა”, not “სეივი”.\n\n**Loanwords to Keep**\nSome loanwords are acceptable in tech contexts:\n\n* ბეში, მოდელი, ჩელი, ვერშენი, აპდეითი, პლაგინი, დეშბორდი, ინტერესი, ჰები.\n\n**Terminology**\nUse consistent Georgian AI vocabulary:\n\n* AI – **ხელოვნური ინტელექტი (AI)**\n* Model – **მოდელი**\n* Prompt – **პრომპტი / მოთხოვნა**\n* Workflow – **ნამუშევარი პროცესი / workflow**\n* Integration – **ინტეგრაცია**\n* Output – **შემოსული შედეგი / output**\n\n**Punctuation**\n\n* Use Georgian comma/period spacing rules (no space before punctuation).\n* Avoid overuse of “...” unless for tone.\n\n---\n\n## **5. Personality**\n\n* **Curious:** always exploring new tools.\n* **Helpful:** gives clear steps, not abstract ideas.\n* **Honest:** if a tool isn’t good, say it directly.\n* **Practical:** “აი, როგორ გამოიყენო დღესვე…”\n\n---\n\n## **6. What Not To Do**\n\n* No pseudo-scientific jargon.\n* No over-promising (“ეს შეცვლის ყველაფერს”).\n* No robotic sentences.\n* No generic filler (“ტექნოლოგია ძალიან სწრაფად ვითარდება…” – only when supported by specifics).\n\n---\n\n## **7. Signature Phrases (Optional)**\n\nUse sparingly to build consistency:\n\n* “მოდი მარტივად ავხსნათ.”\n* “პრაქტიკულად ეს ნიშნავს…”\n* “შენთვის მთავარი სარგებელი ის არის, რომ…”\n\n---\n\n## **8. Writing Formula for Each Post**\n\n1. **Hook (1 sentence)** – relatable question or pain point.\n2. **Context** – what happened in AI (news/tool update).\n3. **Explanation** – clear, short, with examples.\n4. **Why it matters** – practical benefit for Georgian readers.\n5. **How to try it** – steps.\n6. **Quick takeaway** – one clear conclusion.",
              "type": "string"
            },
            {
              "id": "0437c8cc-ef07-4fe8-ad8b-a503597ba24f",
              "name": "SEO Writing rules",
              "value": "**ROLE**\nYou are a Senior SEO Content Strategist and Information Architect. Your goal is to structure web content that satisfies both search engine algorithms (Google EEAT standards) and human user experience (UX). You prioritize scannability, logical hierarchy, and semantic relevance.\n\n**CORE STRUCTURAL RULES**\n\n1.  **Heading Hierarchy (Strict):**\n    * **H1:** One per page. Must contain the primary keyword.\n    * **H2:** Use for main sections. Must be semantically related to the H1.\n    * **H3:** Use for sub-points within H2s. Do not skip from H2 to H4.\n    * **H4:** Use rarely, only for very deep dives or lists within H3s.\n\n2.  **The \"F-Pattern\" Layout:**\n    * Front-load important information.\n    * Keep the introduction concise (under 150 words).\n    * Place a \"Key Takeaways\" or \"Quick Summary\" box immediately after the H1.\n\n3.  **Table of Contents (ToC):**\n    * For any content over 1,000 words, generate a nested Table of Contents anchor list immediately after the Introduction and before the first H2.\n\n4.  **Paragraph & Sentence Structure:**\n    * Maximum 3 sentences per paragraph.\n    * Use simple, active voice.\n    * Target a Flesch-Kincaid reading score of 60-70 (8th-grade level) unless the topic is highly technical.\n\n**VISUAL & MEDIA PLACEMENT**\n\n1.  **Image Frequency:**\n    * **Rule of Thumb:** Insert one visual element (image, infographic, or chart) for every 300 words of text.\n    * **Placement:** Place a visual immediately after every other H2 header to break up text walls.\n    * **Alt Text:** You must provide descriptive Alt Text for every image placeholder.\n\n2.  **Rich Media:**\n    * If a concept is complex, suggest where to embed a video or place a comparison table.\n\n**CONTENT ENHANCERS**\n\n1.  **Bolding:** Bold key phrases and semantic entities (not just keywords) to facilitate skimming. Do not bold entire sentences.\n2.  **Lists:** Use bullet points for non-ordered items and numbered lists for steps. Never write a list as a comma-separated sentence.\n3.  **Tables:** Use Markdown tables whenever comparing 3+ items or data points.\n\n**OUTPUT FORMAT**\nWhen asked to write or structure content, output the response in Markdown. Include placeholders for images using the format:\n`> [IMAGE INSERTION: Description of image | Alt Text: optimized alt text]`\n\n**SEO METADATA (Always include at the top)**\n* **Target Keyword:** [Keyword]\n* **Slug:** /keyword-rich-slug\n* **Title Tag:** [Main Keyword] + [Power Word] | [Brand] (Max 60 chars)\n* **Meta Description:** Actionable summary including the keyword. (Max 155 chars)",
              "type": "string"
            },
            {
              "id": "306718ce-dbe0-4cc3-98e7-f4b53edd0ce6",
              "name": "Webhook",
              "value": "=https://mypen.ge/api/webhooks/blog",
              "type": "string"
            },
            {
              "id": "5151d04f-a772-44fb-932d-72783b17fb04",
              "name": "Secret",
              "value": "mypen-n8n-webhook-secret-2024-secure-key-change-this",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2400,
        3240
      ],
      "id": "cbd91919-d41b-4700-b338-0f4483fc0048",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "url": "https://www.artificial-intelligence.blog/ai-news?format=rss",
        "options": {}
      },
      "id": "198e9ebb-cd41-4f88-a239-0eb75ca95614",
      "name": "Read RSS Feed3",
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1.2,
      "position": [
        -2176,
        3240
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4.1-nano",
          "mode": "list",
          "cachedResultName": "GPT-4.1-NANO"
        },
        "responses": {
          "values": [
            {
              "content": "=You are an AI article curator analyzing articles from an RSS feed.\n\nINPUT DATA:\n{{ $json.data.map((item, index) => `Article ${index + 1}:\nTitle: ${item.title}\nURL: ${item.link}\nContent: ${item[\"content:encoded\"]}`).join(\"\\n\\n---\\n\\n\") }}\n\nTARGET AUDIENCE:\n- Beginners and intermediate AI users\n- Seeking practical, actionable content\n- Interested in: AI productivity tools, chatbots, content creation, automation, workflow optimization, small business applications\n- NOT interested in: academic research, model architecture, deep ML theory, complex policy discussions\n\nSELECTION CRITERIA:\nRank articles based on:\n1. Practicality - Can be implemented immediately by a beginner\n2. Clarity - No technical prerequisites required\n3. Actionability - Contains steps, demos, templates, or concrete examples\n4. Relevance - Directly applicable to real-world tasks\n\nSTRICT OUTPUT REQUIREMENTS:\n- Output ONLY valid JSON\n- Include ONLY the URL of the SINGLE most relevant article\n- NO explanations, reasoning, titles, or additional text\n- NO markdown code blocks\n- Select exactly 1 article (the most relevant one)\n\nOUTPUT FORMAT:\n{\n  \"selected_url\": \"url\"\n}"
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -1728,
        3240
      ],
      "id": "e41d9263-4a33-4a97-bfe3-d091f0bf524a",
      "name": "sorting articles3",
      "credentials": {
        "openAiApi": {
          "id": "eJNHP6n8O3Y9Iv2F",
          "name": "Open Ai - IC"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "e5cf8063-988b-4a50-99a3-99fae813ab99",
      "name": "Aggregate All Articles3",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -1952,
        3240
      ]
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json.output[0].content[0].text;\nconst parsed = JSON.parse(response);\nconst url = parsed.selected_url;\n\nreturn [{ json: { link: url } }];"
      },
      "id": "a9523555-7d52-47ac-b0eb-af880de13435",
      "name": "Parse and Split URLs3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1376,
        3240
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -408,
        3464
      ],
      "id": "3d109e64-1b13-497b-84e7-29c80605c544",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "grfmAQP2FnQMoPJu",
          "name": "Gemini - IC"
        }
      }
    }
  ],
  "connections": {
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for Webhook": {
      "main": [
        [
          {
            "node": "Prepare Webhook Payload3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Images3": {
      "main": [
        [
          {
            "node": "Rewrite and Translate Article3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Webhook Payload3": {
      "main": [
        [
          {
            "node": "Send to Webhook3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rewrite and Translate Article3": {
      "main": [
        [
          {
            "node": "Prepare for Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Article3": {
      "main": [
        [
          {
            "node": "Extract Article Content3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Article Content3": {
      "main": [
        [
          {
            "node": "Process Images3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Read RSS Feed3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read RSS Feed3": {
      "main": [
        [
          {
            "node": "Aggregate All Articles3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sorting articles3": {
      "main": [
        [
          {
            "node": "Parse and Split URLs3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate All Articles3": {
      "main": [
        [
          {
            "node": "sorting articles3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse and Split URLs3": {
      "main": [
        [
          {
            "node": "Get Article3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Rewrite and Translate Article3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "c0320382499acc1816c05e1130ede806d6731eecdef3b30ac30aabf4236c8764"
  }
}