{
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -2512,
        1376
      ],
      "id": "fd91bf13-0b4c-4466-8c9b-45b2ff3f8d77",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "jsCode": "// Extract and format images from the article\nconst input = $input.first().json;\nconst htmlData = input.data || '';\nlet imageSrcs = input.images || [];\n\n// Handle case where images might be a single value or array\nif (!Array.isArray(imageSrcs)) {\n  imageSrcs = imageSrcs ? [imageSrcs] : [];\n}\n\n// Convert relative URLs to absolute URLs if needed\nconst articleUrl = $('Get Article').first().json.url || '';\nconst baseUrl = articleUrl ? new URL(articleUrl).origin : '';\n\nconst processedImages = imageSrcs.map(src => {\n  if (!src || typeof src !== 'string') return null;\n  // If relative URL, make it absolute\n  if (src.startsWith('//')) {\n    return 'https:' + src;\n  }\n  if (src.startsWith('/')) {\n    return baseUrl + src;\n  }\n  if (src.startsWith('http')) {\n    return src;\n  }\n  return baseUrl + '/' + src;\n}).filter(Boolean);\n\n// Format images as a list for the LLM\nconst imagesList = processedImages.length > 0 \n  ? processedImages.map((url, idx) => `Image ${idx + 1}: ${url}`).join('\\n')\n  : 'No images found in article';\n\nreturn [{\n  json: {\n    data: htmlData,\n    images: imagesList,\n    imageUrls: processedImages\n  }\n}];"
      },
      "id": "0c45e4e8-35d9-4540-991a-d4850eece917",
      "name": "Process Images1",
      "type": "n8n-nodes-base.code",
      "position": [
        -368,
        1840
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// Prepare webhook payload with proper data mapping\nconst article = $input.first().json;\n\n// Validate required fields\nif (!article.title || article.title.trim() === '') {\n  throw new Error('Title is required but was empty or missing');\n}\n\nif (!article.body || article.body.trim() === '') {\n  throw new Error('Body/content is required but was empty or missing');\n}\n\n// Get first image from processed images as fallback\nconst processedImages = $('Process Images1').first().json.imageUrls || [];\nconst firstImage = processedImages.length > 0 ? processedImages[0] : null;\n\n// Use LLM-provided featured_image or fallback to first image\n// Handle case where LLM might return 'null' as string\nlet featuredImage = article.featured_image;\nif (!featuredImage || featuredImage === 'null' || featuredImage === 'None' || featuredImage === '') {\n  featuredImage = firstImage;\n}\n\n// Validate featured_image URL format if provided\nif (featuredImage && typeof featuredImage === 'string') {\n  try {\n    new URL(featuredImage);\n  } catch (e) {\n    // Invalid URL, set to null\n    featuredImage = null;\n  }\n}\n\n// Prepare payload matching webhook schema\nconst payload = {\n  title: article.title.trim(),\n  title_ka: article.title.trim(),\n  content: article.body.trim(),\n  content_ka: article.body.trim(),\n  excerpt: (article.summary || '').trim(),\n  excerpt_ka: (article.summary || '').trim(),\n  featured_image: featuredImage || null,\n  author: 'Mypen Team',\n  published: true\n};\n\n// Final validation\nif (payload.title.length === 0) {\n  throw new Error('Title cannot be empty after trimming');\n}\n\nif (payload.content.length === 0) {\n  throw new Error('Content cannot be empty after trimming');\n}\n\nreturn [{ json: payload }];"
      },
      "id": "33c94784-41c6-48df-9333-28c74103dc12",
      "name": "Prepare Webhook Payload1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        208,
        1840
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Edit Fields').item.json.Webhook }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "id": "b1e4fdab-205d-48dc-b424-8eea7ca61a51",
      "name": "Send to Webhook1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        480,
        1840
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "e4xkr4s6jVKWYVY0",
          "name": "MPEN - IC"
        }
      }
    },
    {
      "parameters": {
        "text": "={{ $json.data }}\n\n## Images from Original Article:\n{{ $json.images }}",
        "attributes": {
          "attributes": [
            {
              "name": "title",
              "description": "title of article in Georgian",
              "required": true
            },
            {
              "name": "summary",
              "description": "summary of article in Georgian (150-160 characters for SEO)",
              "required": true
            },
            {
              "name": "body",
              "description": "body of article in Georgian as clean, semantic HTML",
              "required": true
            },
            {
              "name": "featured_image",
              "description": "URL of the best image from the article to use as featured image (first relevant image, or null if none)"
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "=You are a blog content writer who rewrites and translates articles to Georgian following strict brand voice guidelines and SEO best practices.\n\n## CRITICAL INSTRUCTIONS:\n1. **TRANSLATE TO GEORGIAN** - The entire article (title, summary, body) must be in Georgian\n2. **REWRITE, DON'T COPY** - Rewrite the content in your own words while preserving the core message and information\n3. **FOLLOW BRAND VOICE** - Use the brand voice guide below strictly\n4. **OUTPUT FORMAT** - Body must be clean, semantic HTML (NOT Markdown)\n5. **NO DATES** - Do not include the date of the article because the publishing date is not determined yet\n6. **INCLUDE IMAGES** - Use the images provided from the original article, embed them naturally in the HTML body\n\n## SEO HTML Requirements:\n{{ $('Edit Fields').item.json['SEO Writing rules'] }}\n\n## HTML Structure Example:\n<h2>სათაური</h2>\n<p>პარაგრაფი ტექსტით...</p>\n<img src=\"image-url.jpg\" alt=\"აღწერა ქართულად\" />\n<h3>ქვესათაური</h3>\n<p>მეტი ტექსტი...</p>\n<ul>\n<li>სიის ელემენტი 1</li>\n<li>სიის ელემენტი 2</li>\n</ul>\n\n## Brand Voice Guide\n{{ $('Edit Fields').item.json['Brand Voice'] }}\n\n## Original Article to Rewrite/Translate:\nThe following article might be English. Rewrite it in Georgian following the brand voice guide above. Make it natural, engaging, and adapted for Georgian readers while maintaining all key information and insights. Include images from the original article naturally within the content."
        }
      },
      "id": "ddc8833c-36a1-4506-baa5-1ca2bdb350e5",
      "name": "Rewrite and Translate Article",
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "position": [
        -144,
        1840
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "url": "={{ $json.link }}",
        "options": {}
      },
      "id": "78899259-bafd-4289-a3c0-0bc5a484a3fc",
      "name": "Get Article",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -816,
        1840
      ],
      "typeVersion": 4.2
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "data",
              "cssSelector": "article",
              "returnValue": "html"
            },
            {
              "key": "images",
              "cssSelector": "img",
              "returnValue": "attribute",
              "attribute": "src"
            }
          ]
        },
        "options": {}
      },
      "id": "113c310c-2752-4464-909d-970e2b4b8018",
      "name": "Extract Article Content",
      "type": "n8n-nodes-base.html",
      "position": [
        -592,
        1840
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8739c4a4-a9ed-47b0-b9a7-192baac7fd28",
              "name": "Brand Voice",
              "value": "# **Brand Voice Guide – AI Tools & AI News Blog (Georgian)**\n\n## **1. Core Identity**\n\n**Friendly expert.**\nExplains complex AI topics simply, never oversimplifies.\nTone stays conversational, practical, and reader-focused.\n\n---\n\n## **2. Tone**\n\n* **Warm, direct, human.**\n* **Authoritative without being rigid.**\n* **Energetic but not hype-driven.**\n* **Curious, excited about new tools.**\n\nExamples (in Georgian style):\n\n* “მოკლედ, რა უნდა იცოდე…”\n* “ერთი სიტყვით, ეს ფუნქცია ნამდვილ მოწყობილ ‘shortcut’-ად იქცევა.”\n* “მოდი პრაქტიკულად გავიგოთ, რას ნიშნავს ეს შენთვის.”\n\n---\n\n## **3. Style**\n\n* Short paragraphs.\n* Clear structure: **what it is → why it matters → how to use → quick verdict**.\n* Avoid long academic sentences.\n* Use everyday examples, not theory.\n\n---\n\n## **4. Language (Georgian-Specific Rules)**\n\nTo ensure correctness and natural flow:\n\n**Grammar & Syntax**\n\n* Prefer **active voice**:\n  “AI გეტყვის…” instead of “AI-ის მიერ ითქმება…”\n* Keep verb endings consistent with modern spoken Georgian:\n  use “გაიგებ”, not “გაიგებთ”, unless speaking formally.\n* Avoid literal English calques. Use native constructions:\n\n  * “შესაძლებლობა”, not “ოპშენი”.\n  * “პარამეტრი”, not “სეტინგი” (unless tool-specific).\n  * “შენახვა”, not “სეივი”.\n\n**Loanwords to Keep**\nSome loanwords are acceptable in tech contexts:\n\n* ბეში, მოდელი, ჩელი, ვერშენი, აპდეითი, პლაგინი, დეშბორდი, ინტერესი, ჰები.\n\n**Terminology**\nUse consistent Georgian AI vocabulary:\n\n* AI – **ხელოვნური ინტელექტი (AI)**\n* Model – **მოდელი**\n* Prompt – **პრომპტი / მოთხოვნა**\n* Workflow – **ნამუშევარი პროცესი / workflow**\n* Integration – **ინტეგრაცია**\n* Output – **შემოსული შედეგი / output**\n\n**Punctuation**\n\n* Use Georgian comma/period spacing rules (no space before punctuation).\n* Avoid overuse of “...” unless for tone.\n\n---\n\n## **5. Personality**\n\n* **Curious:** always exploring new tools.\n* **Helpful:** gives clear steps, not abstract ideas.\n* **Honest:** if a tool isn’t good, say it directly.\n* **Practical:** “აი, როგორ გამოიყენო დღესვე…”\n\n---\n\n## **6. What Not To Do**\n\n* No pseudo-scientific jargon.\n* No over-promising (“ეს შეცვლის ყველაფერს”).\n* No robotic sentences.\n* No generic filler (“ტექნოლოგია ძალიან სწრაფად ვითარდება…” – only when supported by specifics).\n\n---\n\n## **7. Signature Phrases (Optional)**\n\nUse sparingly to build consistency:\n\n* “მოდი მარტივად ავხსნათ.”\n* “პრაქტიკულად ეს ნიშნავს…”\n* “შენთვის მთავარი სარგებელი ის არის, რომ…”\n\n---\n\n## **8. Writing Formula for Each Post**\n\n1. **Hook (1 sentence)** – relatable question or pain point.\n2. **Context** – what happened in AI (news/tool update).\n3. **Explanation** – clear, short, with examples.\n4. **Why it matters** – practical benefit for Georgian readers.\n5. **How to try it** – steps.\n6. **Quick takeaway** – one clear conclusion.",
              "type": "string"
            },
            {
              "id": "0437c8cc-ef07-4fe8-ad8b-a503597ba24f",
              "name": "SEO Writing rules",
              "value": "**ROLE**\nYou are a Senior SEO Content Strategist and Information Architect. Your goal is to structure web content that satisfies both search engine algorithms (Google EEAT standards) and human user experience (UX). You prioritize scannability, logical hierarchy, and semantic relevance.\n\n**CORE STRUCTURAL RULES**\n\n1.  **Heading Hierarchy (Strict):**\n    * **H1:** One per page. Must contain the primary keyword.\n    * **H2:** Use for main sections. Must be semantically related to the H1.\n    * **H3:** Use for sub-points within H2s. Do not skip from H2 to H4.\n    * **H4:** Use rarely, only for very deep dives or lists within H3s.\n\n2.  **The \"F-Pattern\" Layout:**\n    * Front-load important information.\n    * Keep the introduction concise (under 150 words).\n    * Place a \"Key Takeaways\" or \"Quick Summary\" box immediately after the H1.\n\n3.  **Table of Contents (ToC):**\n    * For any content over 1,000 words, generate a nested Table of Contents anchor list immediately after the Introduction and before the first H2.\n\n4.  **Paragraph & Sentence Structure:**\n    * Maximum 3 sentences per paragraph.\n    * Use simple, active voice.\n    * Target a Flesch-Kincaid reading score of 60-70 (8th-grade level) unless the topic is highly technical.\n\n**VISUAL & MEDIA PLACEMENT**\n\n1.  **Image Frequency:**\n    * **Rule of Thumb:** Insert one visual element (image, infographic, or chart) for every 300 words of text.\n    * **Placement:** Place a visual immediately after every other H2 header to break up text walls.\n    * **Alt Text:** You must provide descriptive Alt Text for every image placeholder.\n\n2.  **Rich Media:**\n    * If a concept is complex, suggest where to embed a video or place a comparison table.\n\n**CONTENT ENHANCERS**\n\n1.  **Bolding:** Bold key phrases and semantic entities (not just keywords) to facilitate skimming. Do not bold entire sentences.\n2.  **Lists:** Use bullet points for non-ordered items and numbered lists for steps. Never write a list as a comma-separated sentence.\n3.  **Tables:** Use Markdown tables whenever comparing 3+ items or data points.\n\n**OUTPUT FORMAT**\nWhen asked to write or structure content, output the response in Markdown. Include placeholders for images using the format:\n`> [IMAGE INSERTION: Description of image | Alt Text: optimized alt text]`\n\n**SEO METADATA (Always include at the top)**\n* **Target Keyword:** [Keyword]\n* **Slug:** /keyword-rich-slug\n* **Title Tag:** [Main Keyword] + [Power Word] | [Brand] (Max 60 chars)\n* **Meta Description:** Actionable summary including the keyword. (Max 155 chars)",
              "type": "string"
            },
            {
              "id": "306718ce-dbe0-4cc3-98e7-f4b53edd0ce6",
              "name": "Webhook",
              "value": "=https://mypen.ge/api/webhooks/blog",
              "type": "string"
            },
            {
              "id": "5151d04f-a772-44fb-932d-72783b17fb04",
              "name": "Secret",
              "value": "mypen-n8n-webhook-secret-2024-secure-key-change-this",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2064,
        1840
      ],
      "id": "d1f5039a-227e-459a-b4e5-ffcee75a301b",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "url": "https://www.artificial-intelligence.blog/ai-news?format=rss",
        "options": {}
      },
      "id": "7ac3f4ec-b0d8-4b1c-b269-9f992e53e60e",
      "name": "Read RSS Feed",
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1.2,
      "position": [
        -1840,
        1840
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4.1-nano",
          "mode": "list",
          "cachedResultName": "GPT-4.1-NANO"
        },
        "responses": {
          "values": [
            {
              "content": "=You are an AI article curator analyzing articles from an RSS feed.\n\nINPUT DATA:\n{{ $json.data.map((item, index) => `Article ${index + 1}:\nTitle: ${item.title}\nURL: ${item.link}\nContent: ${item[\"content:encoded\"]}`).join(\"\\n\\n---\\n\\n\") }}\n\nTARGET AUDIENCE:\n- Beginners and intermediate AI users\n- Seeking practical, actionable content\n- Interested in: AI productivity tools, chatbots, content creation, automation, workflow optimization, small business applications\n- NOT interested in: academic research, model architecture, deep ML theory, complex policy discussions\n\nSELECTION CRITERIA:\nRank articles based on:\n1. Practicality - Can be implemented immediately by a beginner\n2. Clarity - No technical prerequisites required\n3. Actionability - Contains steps, demos, templates, or concrete examples\n4. Relevance - Directly applicable to real-world tasks\n\nSTRICT OUTPUT REQUIREMENTS:\n- Output ONLY valid JSON\n- Include ONLY the URL of the SINGLE most relevant article\n- NO explanations, reasoning, titles, or additional text\n- NO markdown code blocks\n- Select exactly 1 article (the most relevant one)\n\nOUTPUT FORMAT:\n{\n  \"selected_url\": \"url\"\n}"
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -1392,
        1840
      ],
      "id": "04a0b919-f532-46c3-afad-b3210a03ad5b",
      "name": "sorting articles",
      "credentials": {
        "openAiApi": {
          "id": "eJNHP6n8O3Y9Iv2F",
          "name": "Open Ai - IC"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "891d2886-a923-414e-9ca6-411300bce482",
      "name": "Aggregate All Articles",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -1616,
        1840
      ]
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json.output[0].content[0].text;\nconst parsed = JSON.parse(response);\nconst url = parsed.selected_url;\n\nreturn [{ json: { link: url } }];"
      },
      "id": "4465d685-fb07-4c7f-a483-fde24ec7d47e",
      "name": "Parse and Split URLs",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1040,
        1840
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        32,
        2096
      ],
      "id": "4489b584-d439-422c-8923-42128a804573",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "eJNHP6n8O3Y9Iv2F",
          "name": "Open Ai - IC"
        }
      }
    }
  ],
  "connections": {
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Images1": {
      "main": [
        [
          {
            "node": "Rewrite and Translate Article",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Webhook Payload1": {
      "main": [
        [
          {
            "node": "Send to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rewrite and Translate Article": {
      "main": [
        [
          {
            "node": "Prepare Webhook Payload1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Article": {
      "main": [
        [
          {
            "node": "Extract Article Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Article Content": {
      "main": [
        [
          {
            "node": "Process Images1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Read RSS Feed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read RSS Feed": {
      "main": [
        [
          {
            "node": "Aggregate All Articles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sorting articles": {
      "main": [
        [
          {
            "node": "Parse and Split URLs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate All Articles": {
      "main": [
        [
          {
            "node": "sorting articles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse and Split URLs": {
      "main": [
        [
          {
            "node": "Get Article",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Rewrite and Translate Article",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "c0320382499acc1816c05e1130ede806d6731eecdef3b30ac30aabf4236c8764"
  }
}